# 问题三：未知类别文物分类及敏感性分析报告

## 1. 总体目标

本报告旨在解决问题三的核心任务：
1.  **分类未知文物**：利用在问题二中建立的分类模型，对附件三中未明确类别的玻璃文物进行化学成分分析，鉴别其所属类型（高钾玻璃或铅钡玻璃）。
2.  **评估结果敏感性**：对分类结果的稳定性与可靠性进行深入分析，以评估模型在面对不同数据时的表现。

## 2. 文物类型鉴别

### 2.1. 分析方法

我们采用了在问题二中训练和验证的两种最优模型——**逻辑回归**和**决策树**——来进行交叉验证。整个过程通过执行 `3/problem3_classification.py` 完成，其核心逻辑如下：

1.  **数据加载**：加载已经过ALR（加性对数比）变换的附件三数据 (`3/附件3_处理后_ALR.csv`)。

2.  **特征工程 (关键步骤)**：为了确保预测的准确性，我们必须为新数据构建与模型训练时完全一致的特征集。
    *   **处理无效值**：原始的ALR变换数据中存在`-inf`值（通常由`log(0)`产生），我们将其替换为0。这与训练阶段处理`NaN`值的逻辑保持了一致性。
    *   **创建核心特征**：
        *   `风化特征 (Weathering)`：根据"表面风化"文本信息，创建一个二元特征（风化=1, 无风化=0）。
        *   `交互特征 (Interaction Features)`：为每一个ALR化学成分特征，都创建其与`风化特征`的乘积项 (`ALR_*_x_Weathering`)。
    *   **构建最终特征矩阵**：将所有ALR特征、风化特征和交互特征合并，其顺序与模型训练时完全一致，这是保证模型正确应用的前提。

3.  **模型应用**：
    *   加载预先保存的逻辑回归和决策树模型 (`.joblib`文件)。
    *   加载与各模型配对的数据缩放器 (`scaler`)，对新数据的特征矩阵进行标准化。
    *   将处理后的数据输入模型，得出预测结果。

### 2.2. 分类结果与初步解读

执行上述流程后，我们得到以下分类结果：

```csv
文物编号,逻辑回归预测,逻辑回归预测为高钾的概率,决策树预测
A1,高钾,0.9396739866335334,高钾
A2,铅钡,0.2863112041099779,高钾
A3,铅钡,0.1199919487797667,铅钡
A4,铅钡,0.24620914588062723,铅钡
A5,铅钡,0.020770428199432135,铅钡
A6,高钾,0.9214413423228262,高钾
A7,高钾,0.9785582412503621,高钾
A8,铅钡,0.35545211142366434,铅钡
```

**初步解读**：
*   **结果高度一致**：在8个样本中，有7个样本的两种模型预测结果完全一致。
*   **发现分歧点**：文物 **A2** 是一个关键的特例。逻辑回归模型判定其为"铅钡"（判定为高钾的概率仅为28.6%），而决策树模型则判定其为"高钾"。
*   **引出敏感性分析**：这种模型间的分歧表明，文物 `A2` 的化学成分特征可能位于两个类别的决策边界附近。因此，其分类结果可能对模型的微小变化或数据的微小扰动非常敏感。这促使我们必须进行下一步的敏感性分析来评估所有分类结果的可靠性。

## 3. 分类结果的敏感性分析

为了量化分类结果的稳健性，我们从两个维度进行了敏感性分析，具体由 `3/sensitivity_analysis.py` 脚本实现。

### 3.1. 方法一：自助法 (Bootstrap)

此方法用于检验**模型对训练数据的稳定性**。

*   **执行过程**：我们从问题二的原始训练数据中进行有放回的随机抽样500次，每次都生成一个新的训练数据集。然后，用每个新的数据集训练一个新的逻辑回归模型，并用它来预测附件三的样本。
*   **评估指标**：
    1.  **高钾概率的标准差**：衡量500次预测概率的波动大小。值越小，预测越稳定。
    2.  **与原始预测一致率**：衡量500次预测的分类标签与我们初次预测结果相同的比例。比例越高，结果越可靠。

*   **分析结果**：
    ```
      文物编号 原始预测  高钾概率的标准差  与原始预测一致率
    0   A1     高钾      0.176026       0.946
    1   A2     铅钡      0.174831       0.868
    2   A3     铅钡      0.093239       0.988
    3   A4     铅钡      0.109561       0.986
    4   A5     铅钡      0.102531       0.986
    5   A6     高钾      0.047573       1.000
    6   A7     高钾      0.302624       0.884
    7   A8     铅钡      0.165575       0.910
    ```

*   **结果解读**：
    *   **最稳健样本**：文物 **A6** 表现最佳，其预测一致率达到100%，且概率标准差最低，表明其"高钾"分类极为可靠。
    *   **最敏感样本**：文物 **A2** 和 **A7** 表现出较高的敏感性。
        *   **A2** 的一致率仅为86.8%，证实了我们的初步判断——它的分类结果非常容易因训练数据的变化而翻转。
        *   **A7** 的概率标准差最大，说明不>同模型对其分类的"信心"波动剧烈。

### 3.2. 方法二：数据扰动法

此方法用于检验**分类结果对样本自身数据微小变化的鲁棒性**。

*   **执行过程**：我们对附件三中每个样本的特征值注入逐渐增强的高斯噪声（`X_noisy = X * (1 + ε * N(0,1))`），然后观察其分类结果何时会发生改变。
*   **评估指标**：**能容忍的最大噪声水平(ε)**。这个值越大，说明分类结果对化学成分的测量误差或微小波动越不敏感。

*   **分析结果**：
    ```
      文物编号 原始预测  能容忍的最大噪声水平(ε)
    0   A1     高钾           0.50
    1   A2     铅钡           0.50
    2   A3     铅钡           0.50
    3   A4     铅钡           0.50
    4   A5     铅钡           0.46
    5   A6     高钾           0.50
    6   A7     高钾           0.50
    7   A8     铅钡           0.43
    ```

*   **结果解读**：
    *   从数据本身来看，模型的预测结果相当稳健。绝大多数样本都能容忍高达50%的特征数据噪声而不改变其分类。这说明模型的决策边界并非"摇摇欲坠"，而是有较强的确定性。
    *   文物 `A5` 和 `A8` 相对能容忍的噪声水平略低，但依然稳健。

## 4. 最终结论

综合初始分类和两种敏感性分析，我们对附件三的文物分类得出以下结论：

1.  **高置信度分类**：
    *   **高钾玻璃**：**A1, A6, A7**。其中 `A6` 的分类结果最为可靠。`A1` 和 `A7` 虽然在自助法分析中显示出一定的敏感性，但其被判定为"高钾"的原始概率非常高（>93%），且能抵抗极大的数据扰动，因此其"高钾"分类依然具有高置信度。
    *   **铅钡玻璃**：**A3, A4, A5, A8**。这些样本在所有分析中都表现出高度的一致性和稳定性，其"铅钡"分类结果非常可靠。

2.  **低置信度/敏感样本**：
    *   **A2 (铅钡)**：此样本是所有样本中最不确定的一个。尽管我们的主模型（逻辑回归）判定其为"铅钡"，但其概率较低，且在决策树模型和自助法分析中都显示出极大的不稳定性。**结论是：倾向于判定为铅钡，但其化学成分非常接近分类边界，结果敏感，置信度较低。**

总体而言，我们建立的分类流程是有效且可靠的，敏感性分析为我们评估和理解预测结果的置信度提供了强有力的数据支持。 