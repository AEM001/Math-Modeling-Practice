# 2023 年高教社杯全国大学生数学建模竞赛题目

# 蔬菜类商品的自动定价与补货决策

- 在生鲜商超中，商超通常会根据各商品的「历史销售」和「需求情况」**每天**进行补货。
- 商家须在不确切知道「具体单品」和「进货价格」的情况下，做出当日各蔬菜品类的补货决策。
- 蔬菜的定价一般采用「成本加成定价」方法，商超对「运损」和「品相变差」的商品通常进行「打折销售」。
- 可靠的市场需求分析，对补货决策和定价决策尤为重要：
  - 从需求侧来看，蔬菜类商品的销售量与时间往往存在一定的关联关系；
  - 从供给侧来看，蔬菜的供应品种在 4 月至 10 月较为丰富，商超「销售空间的限制」使得合理的「销售组合」变得极为重要。

## 问题

请根据附件和实际情况建立数学模型解决以下问题：


- 问题2 考虑商超以品类为单位做补货计划，请分析各蔬菜品类的「销售总量」与「成本加成定价」的关系，并给出各蔬菜品类未来一周(2023 年 7 月 1-7 日)的「日补货总量」和「定价策略」，使得商超收益最大。


## 数据附件
/Users/Mac/Downloads/Math-Modeling-Practice/23C/2/单品级每日汇总表.csv
/Users/Mac/Downloads/Math-Modeling-Practice/23C/2/品类级每日汇总表.csv

## 初步思路（待修正）
**2 品类补货与定价策略**

**2.1 需求与价格关系建模**

**2.1.1 数据预处理**
/Users/Mac/Downloads/Math-Modeling-Practice/23C/2/单品级每日汇总表.csv
/Users/Mac/Downloads/Math-Modeling-Practice/23C/2/品类级每日汇总表.csv
因为品类内各单品批发价、售价存在不同，所以不能单纯按照品类级销售量-售价来拟合模型。所以下面按照单品级进行建模分析。

按日计算各单品的历史定价加成率，数据范围选取附件中所有日期中有效数据，并且事先按照日期先后划分训练集和测试集，即日期最新的30%数据作为测试集，用以评估模型对相对近期的数据的预测能力。

需要注意附件中存在打折促销的情况，这些数据直接选择忽视。每日只计算正常售价和正常售价对应的销量。

**2.1.2 双对数模型拟合与参数估计**

选择双对数模型可以较直观地展现价格和销量的比例变化关系，同时取对数可以降低数据可能存在的异方差影响。

自变量定为$\ln P$，其中P为定价。因变量为$\ln Q$。选择的是双对数模型：

$$\ln Q = \alpha + \beta\ln P + \varepsilon$$

$\alpha$为常数项，$\beta$反映价格每改变1%销售量改变的百分比，$\varepsilon$为随机误差项。

用OLS估计参数。

一般情况下，结合生活实际，$\beta$应当为负值。若为正，需要单独分析是否是特殊情况。比较不同单品的$\beta$值可以分析什么单品销售量对定价变动更敏感。用R\^2、F检验、t检验等检验模型显著性。

如果双对数模型没有达到预期效果，可以考虑线性、二次作为基础保底模型。

**2.1.3 用测试集验证模型预测能力**

将测试集中数据按相同方法处理带入自变量中，计算预期销售量。分别计算训练集和测试集的平均绝对百分比误差MAPE和均方根误差RMSE。若相差不大则可认为模型泛化能力较好。

**2.2 未来一周预测优化**

**2.2.1 时间序列模型预测**

对各单品历史数据进行时间序列模型建模，并直接计算未来一周各单品预测销售量数据。用相同方法预测批发价。

**2.2.2 利润优化模型**

建立目标函数：

$$B = \sum_{}^{}(Q \times P - R \times C)$$

B为利润，Q为预测销量，R为进货量，C为批发价。

最终优化目标是使利润最大：

Max $B = \sum_{}^{}(Q \times P - R \times C)$

下面规定约束条件。

每日补货量R必须大于预测的销售量Q，且必须考虑进损耗问题。所以需要有：

$$R \times (1 - W) \geq Q$$

W为损耗率。

考虑其他数据在合理范围内，最终优化模型：

Max $B$

S.t. $B = \sum_{}^{}(Q \times P - R \times C)$

> $$R \times (1 - W) \geq Q$$
>
> $$100\% < \frac{P}{C} \leq 200\%$$
>
> $$e^{\alpha + \beta\ln P} \leq Q$$

其中R和P为自变量。搜索得到R和P的最优值，并按照品类合并得到题目要求数据。


问题二好像测试集效果不太好，但是我目前也没想到什么太好的方法
自变量定为$\ln P$，其中P为定价。因变量为$\ln Q$。选择的是双对数模型：

$$\ln Q = \alpha + \beta\ln P + \varepsilon$$

$\alpha$为常数项，$\beta$反映价格每改变1%销售量改变的百分比，$\varepsilon$为随机误差项。

用OLS估计参数。
这个双对数模型方程要不要加个时间自变量？（周几，因为要7.1-7.7一周内的计划），但是从问题一分析的结果来看好像这个和时间没什么明显关系。。或者试试别的拟合方程


可以先用这个非参数检验看看周几和日销量的关系：
"
**方案三：使用非参数检验 (Non-parametric Test)**

如果数据严重偏离正态分布，且数据变换和稳健方法都无法解决问题，那么最后的，也是最强大的武器就是非参数检验。

* **目标**：完全抛开对数据分布形态的假设，转而比较数据的中位数或秩。

* **主要方法**：

  * Kruskal-Wallis H 检验：`scipy.stats.kruskal()`

    * 适用场景：当数据同时不满足正态性和方差齐性时，这是标准的替代方法。
    * 它不直接比较各组的均值，而是将所有数据放在一起排序，然后比较各组的平均秩次是否存在显著差异。可以理解为“非参数版本的单因素方差分析”。

* **事后检验 (Post-hoc Test)**：

  * 如果Kruskal-Wallis检验结果显著（p < 0.05），说明至少有一组与其他组不同。此时，您不能用ANOVA的Tukey HSD检验，而需要使用非参数的事后检验，最常用的是 **Dunn's test**。

"