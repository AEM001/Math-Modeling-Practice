# 蔬菜类商品的自动定价与补货决策

- 在生鲜商超中，商超通常会根据各商品的「历史销售」和「需求情况」**每天**进行补货。
- 商家须在不确切知道「具体单品」和「进货价格」的情况下，做出当日各蔬菜品类的补货决策。
- 蔬菜的定价一般采用「成本加成定价」方法，商超对「运损」和「品相变差」的商品通常进行「打折销售」。
- 可靠的市场需求分析，对补货决策和定价决策尤为重要：
  - 从需求侧来看，蔬菜类商品的销售量与时间往往存在一定的关联关系；
  - 从供给侧来看，蔬菜的供应品种在 4 月至 10 月较为丰富，商超「销售空间的限制」使得合理的「销售组合」变得极为重要。

## 问题

请根据附件和实际情况建立数学模型解决以下问题：

- 问题3 因蔬菜类商品的销售空间有限，商超希望进一步制定单品的补货计划，要求可售单品总数控制在 27-33 个，且各单品订购量满足最小陈列量 2.5 千克的要求。根据 2023年6月24-30日的可售品种（数据已经进行处理，仅仅保留可售商品），给出 7月1日的「单品补货量」和「定价策略」，在**尽量满足市场对各品类蔬菜商品需求**的前提下，使得商超收益最大。



## 初步思路
**3 单品补货和定价策略**

**3.1 需求量预测和单品初步选择**

**3.1.1 基于时间序列模型预测销售量**$\mathbf{Q}_{\mathbf{p}}$

使用/Users/Mac/Downloads/Math-Modeling-Practice/23C/3/过滤后单品级汇总表.csv，重点突出提取以周为周期的变化趋势。然后基于随机森林模型直接计算7.1的销售量预测数据$Q_{p}$。

2023.7.1为周六，将周几作为辅助的自变量，拟合销售量-日期的函数关系。或者直接提取历史销售量该单品的统计规律，总结周六的销售量和工作日销量的倍数关系等规律，以此基于短期数据和移动平均法预测$Q_{p}$。
参考：
'RandomForest': RandomForestRegressor(
                n_estimators=50, max_depth=8, min_samples_split=10, 
                min_samples_leaf=5, random_state=self.modeling_config['random_state']
            ),

**3.1.2 上架单品初步选择**

选择上架单品需要接下来使用优化模型具体决定，但是为了简化搜索，可以预先进行初步选择。依据前面预测的销量，第一步直接剔除所有预测销量不足2.5kg的单品，防止最低标准补货仍滞销。随后结合前面预测销售量时的建模方式，保留不超过40种候选单品，优先淘汰预测销售量建模质量差的单品，因为这些单品预测的准确性较差，容易出现滞销的异常情况。同时尽量避免出现某品类全部不选择的极端情况。

**3.2 建立优化模型**

**3.2.1 决策变量**

决策变量包括：

单品是否选择$x_{i}$。01变量，1表示第i个单品被选中进货，0表示未被选中。

进货量$P_{i}$。表示第i个单品的进货量，仅当单品被选中时该值有效。

加成率$A_{i}$。表示第i个单品的成本加成率，可用以计算出单品售价。因为加成率的范围大体较稳定，所以不直接使用售价作为决策变量。

**3.2.2 目标函数**

目标是最大化总利润。虽然还有一个目标是尽量满足商品需求，但是该条件在初步筛选中实际已经作为约束条件。所以还是单目标优化。

总利润的公式如下：

$$B = \sum_{i = 1}^{N}\left( x_{i} \times \left( Q_{i} \times C_{i} \times \left( 1 + A_{i} \right) - P_{i} \times C_{i} \right) \right)$$

其中，B为利润，Q为计算出的加成率预测销量，C为批发价（通过前面相似的方法预测），A为加成率，P为进货量。

**3.2.3 约束条件**

单品上架种类数满足条件27-33种；

存在最小陈列量约束2.5kg，可以通过进货量体现；

加成率存在基本合理范围约束。

最终优化模型呈现如下：

Max
$B = \sum_{i = 1}^{N}\left( x_{i} \times \left( Q_{i} \times C_{i} \times \left( 1 + A_{i} \right) - P_{i} \times C_{i} \right) \right)$

S.t. $Q_{i} = e^{\alpha + \beta\ln P_{i}}$

> $$x_{i} \in \left\{ 0,\ 1 \right\}$$
>
> $$27 \leq \sum_{i = 1}^{N}x_{i} \leq 33$$
>
> $$0 < \sum_{i = 1}^{N}A_{i} \leq 1$$
>
> $$0.8Q_{p} \leq Q_{i} \leq 1.2Q_{p}$$
