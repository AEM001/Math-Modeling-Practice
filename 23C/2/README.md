# 蔬菜类商品自动定价与补货决策 - 问题二解决方案

## 📋 项目概述

**核心目标：** 分析各蔬菜品类的销售总量与成本加成定价的关系，为2023年7月1-7日制定品类级日补货总量和定价策略，使得商超收益最大。

## 🎯 最终结果

### 各品类未来一周最优策略

#### 表1：各品类每日补货总量（千克）

| 品类名称       | 7月1日          | 7月2日          | 7月3日          | 7月4日          | 7月5日          | 7月6日          | 7月7日          |
| -------------- | --------------- | --------------- | --------------- | --------------- | --------------- | --------------- | --------------- |
| 花叶类         | 270.4           | 277.9           | 286.0           | 294.6           | 303.9           | 313.8           | 324.5           |
| 水生根茎类     | 16.0            | 15.9            | 15.8            | 15.7            | 15.6            | 15.6            | 15.5            |
| 茄类           | 8.0             | 8.0             | 8.0             | 8.0             | 8.0             | 8.0             | 8.0             |
| 辣椒类         | 45.0            | 48.2            | 51.8            | 56.1            | 61.0            | 66.9            | 73.8            |
| 食用菌         | 37.4            | 37.5            | 37.7            | 37.9            | 38.2            | 38.5            | 38.8            |
| **合计** | **376.8** | **387.5** | **399.3** | **412.3** | **426.7** | **442.7** | **460.6** |

#### 表2：各品类每日定价策略（加权平均售价，元/千克）

| 品类名称   | 7月1日 | 7月2日 | 7月3日 | 7月4日 | 7月5日 | 7月6日 | 7月7日 |
| ---------- | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| 花叶类     | 2.17   | 2.12   | 2.06   | 2.01   | 1.95   | 1.90   | 1.84   |
| 水生根茎类 | 11.65  | 11.72  | 11.78  | 11.84  | 11.90  | 11.96  | 12.02  |
| 茄类       | 10.04  | 10.04  | 10.03  | 10.02  | 10.02  | 10.01  | 10.01  |
| 辣椒类     | 4.58   | 4.34   | 4.09   | 3.84   | 3.59   | 3.34   | 3.08   |
| 食用菌     | 2.06   | 2.04   | 2.03   | 2.01   | 2.00   | 1.98   | 1.97   |

### 预期收益

- **一周总利润：** ¥3,225.24
- **日均利润：** ¥460.75
- **总补货量：** 2,906.1千克
- **平均毛利率：** 19.4%

## 🏗️ 技术架构

### 整体思路

采用"单品建模 → 品类聚合"的两级优化策略：

1. **单品级需求建模：** 基于双对数模型建立价格-销量关系
2. **单品级利润优化：** 考虑损耗率和成本约束的利润最大化
3. **品类级策略聚合：** 将单品结果按品类汇总形成最终策略

### 核心方法

#### 需求曲线建模

- **模型选择：** 双对数模型 `ln(Q) = α + β * ln(P) + ε`
  - Q: 单品日销量（千克）
  - P: 单品日销售单价（元/千克）
  - β: 价格弹性系数
- **参数估计：** 普通最小二乘法（OLS）
- **模型验证：** R²检验、t检验、F检验

#### 优化模型

- **目标函数：** `Maximize: Profit = Q * P - R * C`
- **约束条件：**
  - 需求约束：`Q = e^(α + β*ln(P))`
  - 补货约束：`R = Q / (1 - W)` （W为损耗率）
  - 价格约束：`C < P ≤ 2 * C`
- **求解方法：** 网格搜索数值优化

#### 批发价预测

- **方法：** 指数平滑法（Exponential Smoothing）
- **输出：** 未来7天的批发价格预测

## 📁 文件结构

### 核心代码文件

```
├── data_preparation.py          # 数据预处理和训练测试集划分
├── demand_modeling.py           # 需求模型训练与验证  
├── optimization.py              # 价格优化和补货策略计算
├── run_complete_analysis.py     # 完整分析流程执行脚本
├── 问题二最终答案.py             # 最终答案表格生成
├── final_results_summary.py     # 详细分析报告生成
└── model_evaluation_report.py   # 模型效果评估报告
```

### 数据文件

```
├── 单品级每日汇总表.csv         # 原始单品销售数据
├── 品类级每日汇总表.csv         # 原始品类汇总数据
├── train_data.csv               # 训练数据集
├── test_data.csv                # 测试数据集
└── demand_models.json           # 训练好的需求模型参数
```

### 结果文件

```
├── demand_model_results.csv     # 需求模型训练结果
├── validation_results.csv       # 模型验证结果
├── daily_optimization_results.csv  # 单品日优化结果明细
├── weekly_category_strategy.csv    # 品类周策略汇总
└── wholesale_forecasts.json     # 批发价预测结果
```

## 🚀 快速开始

### 环境要求

```bash
pandas >= 1.3.0
numpy >= 1.20.0
scipy >= 1.7.0
scikit-learn >= 0.24.0
statsmodels >= 0.12.0
```

### 运行方式

#### 方法1：一键执行完整流程

```bash
python run_complete_analysis.py
```

#### 方法2：分步骤执行

```bash
# 1. 数据预处理
python data_preparation.py

# 2. 需求建模
python demand_modeling.py  

# 3. 优化求解
python optimization.py

# 4. 生成结果报告
python 问题二最终答案.py
python final_results_summary.py
```

## 📊 模型表现

### 需求建模效果

- **建模成功率：** 39个单品成功建模
- **统计显著模型：** 25个（64.1%）
- **平均拟合度：** R² = 0.280
- **预测精度：** 平均MAPE = 2.55

### 价格弹性分析

- **高弹性商品：** 29个（74.4%），|β| > 1
- **低弹性商品：** 10个（25.6%），|β| ≤ 1
- **弹性系数范围：** [-29.69, -0.46]

### 品类表现排名

1. **花叶类：** ¥1,571.68（48.7%利润贡献）
2. **辣椒类：** ¥694.14（21.5%利润贡献）
3. **水生根茎类：** ¥503.86（15.6%利润贡献）
4. **茄类：** ¥245.03（7.6%利润贡献）
5. **食用菌：** ¥210.52（6.5%利润贡献）

## 🔧 模型特色

### 优势特点

1. **精细化建模：** 单品级需求建模，精度更高
2. **现实约束：** 考虑损耗率、成本加成等实际因素
3. **动态定价：** 基于价格弹性的智能定价策略
4. **可扩展性：** 模块化设计，易于扩展和维护

### 创新点

1. **两级优化策略：** "单品建模→品类聚合"的分层优化
2. **鲁棒性设计：** 自动过滤极端beta值，确保数值稳定性
3. **综合评估体系：** 多维度模型效果评估和业务价值分析

## ⚠️ 局限性与改进建议

### 当前局限性

- 部分单品样本量较少，模型稳定性有待提升
- 未考虑季节性、节假日等外部因素
- 品类间替代效应未纳入考虑
- 库存约束和空间限制考虑不充分

### 改进方向

- 增加时间序列特征，考虑季节性趋势
- 引入天气、节假日等外部变量
- 改进批发价预测模型（ARIMA、LSTM等）
- 考虑品类间交叉价格弹性
- 加入库存管理和空间约束优化

## 📈 实际应用建议

1. **动态调整：** 建议每周重新训练模型适应市场变化
2. **重点监控：** 对高价值、高弹性商品加强监控
3. **经验结合：** 结合人工经验对模型结果进行调整
4. **预警机制：** 建立异常检测和预警系统
5. **数据扩充：** 收集更多外部数据提升预测精度
